{% extends 'base.html' %}
{% block title %}{{ product['ìƒí’ˆëª…'] }} ìƒì„¸ ì •ë³´{% endblock %}
<link rel="stylesheet" href="{{ url_for('static', filename='bootstrap.min.css') }}" />
<link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}" />

{% block content %}
<style>
    :root {
        --moa-green: #00d8b0;
        --moa-dark: #020715;
    }
    body,.container{font-family:'NoonnuBasicGothic', sans-serif;}
    .section-title {
        color: var(--moa-dark);
        border-bottom: 3px solid var(--moa-green);
        padding-bottom: 12px;
        margin-bottom: 30px;
    }
    .detail-label {
        font-weight: 600;
        color: #333;
    }
    .card-box {
        border: 1px solid #e0e0e0;
        border-radius: 15px;
        padding: 25px;
        background-color: #fff;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
    }
    .btn-outline-dark {
        border-radius: 30px;
        padding: 6px 18px;
    }
    .btn-success {
        background-color: var(--moa-green);
        border-color: var(--moa-green);
        font-weight: 600;
    }
    .btn-success:hover {
        background-color: #00c0a2;
    }
    .result-box p {
        margin-bottom: 5px;
        color: #333;
    }
    .form-label {
        font-weight: 500;
    }
    .sticky-top {
        z-index: 10;
    }
</style>

<div class="container my-5">
    <div class="row g-5 flex-column-reverse flex-lg-row">
        <!-- ì¢Œì¸¡: ìƒí’ˆ ì„¤ëª… -->
        <div class="col-lg-8">
            <h1 class="section-title">{{ product['ìƒí’ˆëª…'] }}</h1>
            <p><span class="detail-label"> ì€í–‰:</span> {{ product['ê¸ˆìœµíšŒì‚¬ëª…'] }}</p>

            {% if product_type == 'ëŒ€ì¶œ' %}
                <p><span class="detail-label"> ìµœì € ê¸ˆë¦¬:</span> {{ product['ê¸°ë³¸ê¸ˆë¦¬(%)'] }}</p>
                <p><span class="detail-label"> ëŒ€ì¶œ í•œë„:</span> {{ product['ëŒ€ì¶œí•œë„'] }}</p>
                <p><span class="detail-label"> ìƒí™˜ ë°©ì‹:</span> {{ product.get('ìƒí™˜ë°©ì‹', 'ì •ë³´ ì—†ìŒ') }}</p>
                <p><span class="detail-label"> ê°€ì… ëŒ€ìƒ:</span> {{ product.get('ê°€ì…ëŒ€ìƒ', 'ì •ë³´ ì—†ìŒ') }}</p>
                <p><span class="detail-label"> ëŒ€ì¶œ ê¸°ê°„:</span> {{ product.get('ì €ì¶•ê¸°ê°„(ê°œì›”)', 'ì •ë³´ ì—†ìŒ') }}ê°œì›”</p>
            {% else %}
                <p><span class="detail-label"> ìµœê³  ìš°ëŒ€ê¸ˆë¦¬:</span> {{ product.get('ìµœê³ ìš°ëŒ€ê¸ˆë¦¬(%)', 'ì •ë³´ ì—†ìŒ') }}%</p>
                <p><span class="detail-label"> ê¸°ë³¸ ê¸ˆë¦¬:</span> {{ product.get('ê¸°ë³¸ê¸ˆë¦¬(%)', 'ì •ë³´ ì—†ìŒ') }}%</p>
                <p><span class="detail-label"> ê°€ì… ê¸°ê°„:</span> {{ product.get('ì €ì¶•ê¸°ê°„(ê°œì›”)', 'ì •ë³´ ì—†ìŒ') }}ê°œì›”</p>
                <p><span class="detail-label"> ê°€ì… ë°©ë²•:</span> {{ product.get('ê°€ì…ë°©ë²•', 'ì •ë³´ ì—†ìŒ') }}</p>
                <p><span class="detail-label"> ê¸ˆë¦¬ ìœ í˜•:</span> {{ product.get('ê¸ˆë¦¬ìœ í˜•', 'ì •ë³´ ì—†ìŒ') }}</p>
                <p><span class="detail-label"> ì ë¦½ ìœ í˜•:</span> {{ product.get('ì ë¦½ìœ í˜•', 'ì •ë³´ ì—†ìŒ') }}</p>
                <p><span class="detail-label"> ê¸ˆìœµê¶Œ:</span> {{ product.get('ê¸ˆìœµê¶Œ', 'ì •ë³´ ì—†ìŒ') }}</p>
            {% endif %}

            <hr class="my-4">
            <h4 class="fw-bold">âœ¨ ìš°ëŒ€ ì¡°ê±´</h4>
            <p>{{ product.get('ìš°ëŒ€ì¡°ê±´', 'ì •ë³´ ì—†ìŒ') }}</p>

            <div class="mt-5">
                <a href="/{{ product_type_url }}" class="btn btn-outline-dark me-2">â† ëª©ë¡ìœ¼ë¡œ</a>
                <a href="/" class="btn btn-outline-dark">ë©”ì¸ìœ¼ë¡œ</a>
            </div>
        </div>

        <!-- ìš°ì¸¡: ê³„ì‚°ê¸° -->
        <div class="col-lg-4">
            <div class="card-box sticky-top" style="top: 100px;">
                <h4 class="fw-bold mb-4">ğŸ“ˆ ì´ì ê³„ì‚°ê¸°</h4>
                <div class="mb-3">
                    <label class="form-label">ê¸ˆì•¡ (ì›)</label>
                    <input type="number" id="amount" class="form-control" placeholder="ê¸ˆì•¡ ì…ë ¥">
                </div>
                <div class="mb-3">
                    <label class="form-label">ê¸ˆë¦¬ (%)</label>
                    <input type="text" id="rate" class="form-control"
                        value="{% if product_type == 'ëŒ€ì¶œ' %}{{ product.get('ê¸°ë³¸ê¸ˆë¦¬(%)', '0') | extract_rate }}{% else %}{{ product.get('ìµœê³ ìš°ëŒ€ê¸ˆë¦¬(%)', '0') | extract_rate }}{% endif %}" readonly>
                </div>
                <div class="mb-3">
                    <label class="form-label">ê¸°ê°„ (ê°œì›”)</label>
                    <input type="number" id="period" class="form-control"
                        value="{% if product.get('ì €ì¶•ê¸°ê°„(ê°œì›”)') == 'ì •ë³´ ì—†ìŒ' %}12{% else %}{{ product.get('ì €ì¶•ê¸°ê°„(ê°œì›”)') }}{% endif %}">
                </div>
                {% if product_type != 'ëŒ€ì¶œ' %}
                <div class="mb-3">
                    <label class="form-label">ì´ì ë°©ì‹</label>
                    <select id="interestType" class="form-select">
                        <option value="simple">ë‹¨ë¦¬</option>
                        <option value="compound">ë³µë¦¬</option>
                    </select>
                </div>
                {% endif %}
                <button class="btn btn-success w-100" onclick="calculateInterest()">ê³„ì‚°í•˜ê¸°</button>
                <div class="mt-4 result-box">
                    {% if product_type == 'ëŒ€ì¶œ' %}
                        <p><strong>ì›” ë‚©ì…ê¸ˆ:</strong> <span id="monthly-payment">-</span> ì›</p>
                        <p><strong>ì´ ìƒí™˜ì•¡:</strong> <span id="total-amount">-</span> ì›</p>
                        <p><strong>ì´ ì´ì:</strong> <span id="expected-interest">-</span> ì›</p>
                    {% else %}
                        <p><strong>ì˜ˆìƒ ì´ì (ì„¸ì „):</strong> <span id="expected-interest">-</span> ì›</p>
                        <p><strong>ì„¸í›„ ì´ì:</strong> <span id="net-interest">-</span> ì›</p>
                        <p><strong>ì´ ìˆ˜ë ¹ì•¡ (ì„¸í›„):</strong> <span id="total-amount">-</span> ì›</p>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    function calculateInterest() {
        const amount = parseFloat(document.getElementById('amount').value);
        const rate = parseFloat(document.getElementById('rate').value);
        const period = parseInt(document.getElementById('period').value);

        if (!amount || !rate || !period || isNaN(rate)) {
            alert('ê¸ˆì•¡, ê¸ˆë¦¬, ê¸°ê°„ì„ ì •í™•íˆ ì…ë ¥í•˜ì„¸ìš”.');
            return;
        }

        const monthlyRate = rate / 100 / 12;

        {% if product_type == 'ëŒ€ì¶œ' %}
            const r = monthlyRate;
            const n = period;
            const monthlyPayment = amount * r * Math.pow(1 + r, n) / (Math.pow(1 + r, n) - 1);
            const totalPayment = monthlyPayment * n;
            const interest = totalPayment - amount;

            document.getElementById('monthly-payment').innerText = Math.round(monthlyPayment).toLocaleString();
            document.getElementById('expected-interest').innerText = Math.round(interest).toLocaleString();
            document.getElementById('total-amount').innerText = Math.round(totalPayment).toLocaleString();

        {% else %}
            const type = document.getElementById('interestType').value;
            let interest = 0;
            let total = 0;

            if (type === 'simple') {
                interest = amount * (rate / 100) * (period / 12);
                total = amount + interest;
            } else {
                total = amount * Math.pow(1 + monthlyRate, period);
                interest = total - amount;
            }

            const tax = interest * 0.154;
            const netInterest = interest - tax;
            const netTotal = amount + netInterest;

            document.getElementById('expected-interest').innerText = Math.round(interest).toLocaleString();
            document.getElementById('net-interest').innerText = Math.round(netInterest).toLocaleString();
            document.getElementById('total-amount').innerText = Math.round(netTotal).toLocaleString();
        {% endif %}
    }
</script>
{% endblock %}